document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".gmb-tab-button"),t=document.querySelectorAll(".gmb-tab-content");function n(n){e.forEach(function(e){return e.classList.remove("active")}),t.forEach(function(e){return e.classList.remove("active")});var o=document.querySelector('[data-tab="'.concat(n,'"]'));o&&o.classList.add("active");var r=document.querySelector('[data-tab-content="'.concat(n,'"]'));r&&r.classList.add("active"),window.location.hash=n}var o=window.location.hash.substring(1);o||(o=new URLSearchParams(window.location.search).get("tab")),o&&n(o),e.forEach(function(e){e.addEventListener("click",function(){n(this.dataset.tab)})}),window.addEventListener("hashchange",function(){var e=window.location.hash.substring(1);e&&n(e)})}),window.refreshLocations=function(){var e=event.target,t=e.textContent;e.disabled=!0,e.textContent=wgmbrAdmin.i18n.loading;var n=new FormData;n.append("action","wgmbr_refresh_locations"),n.append("nonce",wgmbrAdmin.nonce),fetch(wgmbrAdmin.ajaxUrl,{method:"POST",body:n}).then(function(e){return e.json()}).then(function(n){var o;n.success?window.location.href=wgmbrAdmin.settingsUrl+"&status=success&auto_fetch=1":(alert(wgmbrAdmin.i18n.errorFetchingLocations+" "+((null===(o=n.data)||void 0===o?void 0:o.message)||wgmbrAdmin.i18n.unknownError)),e.disabled=!1,e.textContent=t)}).catch(function(n){alert(wgmbrAdmin.i18n.networkError+" "+n.message),e.disabled=!1,e.textContent=t})},window.clearGMBCache=function(){document.getElementById("gmb-test-result").innerHTML="<p>"+wgmbrAdmin.i18n.resetting+"</p>";var e=new FormData;e.append("action","wgmbr_clear_cache"),e.append("nonce",wgmbrAdmin.nonce),fetch(wgmbrAdmin.ajaxUrl,{method:"POST",body:e}).then(function(e){return e.json()}).then(function(e){if(e.success){var t=e.data&&e.data.message?e.data.message:wgmbrAdmin.i18n.resetSuccess;document.getElementById("gmb-test-result").innerHTML='<div class="gmb-notice success"><p>'+t+"</p></div>"}else document.getElementById("gmb-test-result").innerHTML='<div class="gmb-notice error"><p>'+wgmbrAdmin.i18n.errorResettingReviews+"</p></div>"})},window.testGMBConnection=function(){document.getElementById("gmb-test-result").innerHTML="<p>"+wgmbrAdmin.i18n.loading+"</p>";var e=new FormData;e.append("action","wgmbr_test_connection"),e.append("nonce",wgmbrAdmin.nonce),fetch(wgmbrAdmin.ajaxUrl,{method:"POST",body:e}).then(function(e){return e.json()}).then(function(e){if(e.success)document.getElementById("gmb-test-result").innerHTML='<div class="gmb-notice success"><p>'+wgmbrAdmin.i18n.connectionSuccessful+" "+e.data.count+" "+wgmbrAdmin.i18n.reviewsFetched+"</p></div>";else{var t=e.data&&e.data.message?e.data.message:wgmbrAdmin.i18n.unknownError,n="";e.data&&e.data.response&&(n='<pre style="background: #f0f0f1; padding: 10px; overflow: auto; margin-top: 10px;">'+JSON.stringify(e.data.response,null,2)+"</pre>"),document.getElementById("gmb-test-result").innerHTML='<div class="gmb-notice error"><p>'+wgmbrAdmin.i18n.error+" "+t+"</p>"+n+"</div>"}}).catch(function(e){document.getElementById("gmb-test-result").innerHTML='<div class="gmb-notice error"><p>'+wgmbrAdmin.i18n.networkError+" "+e.message+"</p></div>"})},window.resetGMBCustomization=function(e){if(confirm(wgmbrAdmin.i18n.confirmReset)){var t=e.textContent;e.disabled=!0,e.textContent=wgmbrAdmin.i18n.loading;var n=new FormData;n.append("action","wgmbr_reset_customization"),n.append("nonce",wgmbrAdmin.nonce),fetch(wgmbrAdmin.ajaxUrl,{method:"POST",body:n}).then(function(e){if(!e.ok)throw new Error("HTTP error "+e.status);return e.json()}).then(function(n){var o;n.success?window.location.reload():(alert(wgmbrAdmin.i18n.errorResetting+" "+((null===(o=n.data)||void 0===o?void 0:o.message)||wgmbrAdmin.i18n.unknownError)),e.disabled=!1,e.textContent=t)}).catch(function(n){alert(wgmbrAdmin.i18n.networkError+" "+n.message),e.disabled=!1,e.textContent=t})}},document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("gmb-customization-form");e&&e.addEventListener("submit",function(t){t.preventDefault();var n=e.querySelector('button[type="submit"]'),o=n.textContent;n.disabled=!0,n.textContent=wgmbrAdmin.i18n.loading||"Saving...";var r=new FormData(e);fetch(wgmbrAdmin.ajaxUrl,{method:"POST",body:r}).then(function(e){return e.json()}).then(function(e){var t,r;e.success?(n.textContent=(null===(t=wgmbrAdmin.i18n)||void 0===t?void 0:t.saved)||"âœ“ Saved",n.classList.add("is-success"),setTimeout(function(){n.textContent=o,n.classList.remove("is-success"),n.disabled=!1},2e3)):(n.textContent=(null===(r=wgmbrAdmin.i18n)||void 0===r?void 0:r.errorSaving)||"Error",n.classList.add("is-error"),setTimeout(function(){n.textContent=o,n.classList.remove("is-error"),n.disabled=!1},3e3))}).catch(function(e){var t;n.textContent=(null===(t=wgmbrAdmin.i18n)||void 0===t?void 0:t.errorSaving)||"Error",n.classList.add("is-error"),setTimeout(function(){n.textContent=o,n.classList.remove("is-error"),n.disabled=!1},3e3)})})}),document.addEventListener("DOMContentLoaded",function(){["wgmbr_color_card_bg","wgmbr_color_star","wgmbr_color_text_primary","wgmbr_color_accent","wgmbr_color_text_resume"].forEach(function(e){var t=document.getElementById(e+"_picker"),n=document.getElementById(e+"_hex"),o=document.getElementById(e);t&&n&&o&&(t.addEventListener("input",function(){var e=this.value.toUpperCase();n.value=e,o.value=e}),n.addEventListener("input",function(){var e=this.value.trim().toUpperCase();e&&!e.startsWith("#")&&(e="#"+e,this.value=e),/^#[0-9A-F]{6}$/i.test(e)?(t.value=e,o.value=e,this.style.borderColor=""):e.length>=7&&(this.style.borderColor="#dc3232")}),n.addEventListener("blur",function(){/^#[0-9A-F]{6}$/i.test(this.value)||(this.value=t.value,this.style.borderColor="")}))})}),window.wgmbrCopyShortcode=function(e){var t=document.getElementById("gmb-shortcode");t?navigator.clipboard.writeText(t.textContent).then(function(){var t,n=e.innerHTML;e.innerHTML='<span class="dashicons dashicons-yes"></span> '+((null===(t=wgmbrAdmin.i18n)||void 0===t?void 0:t.copied)||"Copied!"),e.style.color="#46b450",setTimeout(function(){e.innerHTML=n,e.style.color=""},2e3)}).catch(function(e){console.error("Failed to copy shortcode:",e),alert("Failed to copy shortcode")}):console.error("Shortcode element not found")},window.wgmbrGenerateShortcode=function(){var e=document.getElementById("gmb-gen-limit").value,t=document.getElementById("gmb-gen-categories"),n=document.getElementById("gmb-gen-summary").checked,o=document.getElementById("gmb-generated-shortcode");if(o){var r=Array.from(t.querySelectorAll('input[name="gen_category_slugs[]"]:checked')).map(function(e){return e.value}),i="[wgmbr_reviews";e&&"100"!==e&&(i+=' limit="'+e+'"'),r.length>0&&(i+=' category="'+r.join(",")+'"'),n||(i+=' show_summary="false"'),i+="]",o.textContent=i}},window.wgmbrCopyGeneratedShortcode=function(e){var t=document.getElementById("gmb-generated-shortcode");t?navigator.clipboard.writeText(t.textContent).then(function(){var t,n=e.innerHTML;e.innerHTML='<span class="dashicons dashicons-yes"></span> '+((null===(t=wgmbrAdmin.i18n)||void 0===t?void 0:t.copied)||"Copied!"),e.classList.add("is-success"),setTimeout(function(){e.innerHTML=n,e.classList.remove("is-success")},2e3)}).catch(function(e){console.error("Failed to copy shortcode:",e),alert("Failed to copy shortcode")}):console.error("Generated shortcode element not found")};