document.addEventListener("DOMContentLoaded",function(){if("undefined"!=typeof wgmbrManage){window.wgmbr_syncReviewsFromAPI=function(){var e=document.getElementById("sync-result"),n=event.target,t=n.textContent;n.disabled=!0,n.textContent=wgmbrManage.i18n.syncing;var a=new FormData;a.append("action","wgmbr_sync_reviews"),a.append("nonce",wgmbrManage.syncNonce),fetch(wgmbrManage.ajaxUrl,{method:"POST",body:a}).then(function(e){return e.json()}).then(function(a){var r;a.success?(n.textContent=wgmbrManage.i18n.syncComplete,setTimeout(function(){window.location.reload()},2e3)):(e.innerHTML='<div class="gmb-notice error"><p> '+((null===(r=a.data)||void 0===r?void 0:r.message)||wgmbrManage.i18n.errorSyncing)+"</p></div>",n.disabled=!1,n.textContent=t)}).catch(function(a){e.innerHTML='<div class="gmb-notice error"><p>'+wgmbrManage.i18n.networkError+" "+a.message+"</p></div>",n.disabled=!1,n.textContent=t})},document.addEventListener("click",function(e){if(e.target.matches(".gmb-save-review-btn")){var n=e.target,t=n.dataset.postId,a=n.closest("tr"),r=a.querySelector(".gmb-job-input").value,o=Array.from(a.querySelectorAll('input[name="category_ids[]"]:checked')).map(function(e){return e.value}),i=n.textContent;n.disabled=!0;var c=new FormData;c.append("action","wgmbr_save_review"),c.append("post_id",t),c.append("job",r),c.append("nonce",wgmbrManage.saveReviewNonce),o.forEach(function(e){return c.append("category_ids[]",e)}),fetch(wgmbrManage.ajaxUrl,{method:"POST",body:c}).then(function(e){return e.json()}).then(function(e){n.textContent=e.success?wgmbrManage.i18n.updated:wgmbrManage.i18n.error,n.className=e.success?"button button-small is-success":"button button-small is-error",setTimeout(function(){n.textContent=i,n.className="button button-small button-primary gmb-save-review-btn",n.disabled=!1},2e3)}).catch(function(e){console.error("Erreur:",e),n.textContent=wgmbrManage.i18n.error,n.className="button button-small is-error",setTimeout(function(){n.textContent=i,n.className="button button-small button-primary gmb-save-review-btn",n.disabled=!1},2e3)})}});var e=document.getElementById("gmb-create-category-btn"),n=document.getElementById("gmb-new-category-name");e&&n&&(e.addEventListener("click",function(){var t=n.value.trim();t?(e.disabled=!0,e.textContent=wgmbrManage.i18n.creating,fetch(wgmbrManage.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"wgmbr_create_category",category_name:t,nonce:wgmbrManage.nonce})}).then(function(e){return e.json()}).then(function(n){var t;n.success?window.location.reload():(alert(wgmbrManage.i18n.error+" "+((null===(t=n.data)||void 0===t?void 0:t.message)||wgmbrManage.i18n.unknownError)),e.disabled=!1,e.textContent=wgmbrManage.i18n.createCategory)}).catch(function(n){alert(wgmbrManage.i18n.networkError+" "+n.message),e.disabled=!1,e.textContent=wgmbrManage.i18n.createCategory})):alert(wgmbrManage.i18n.enterCategoryName)}),n.addEventListener("keypress",function(n){"Enter"===n.key&&e.click()})),document.querySelectorAll(".gmb-delete-category-btn").forEach(function(e){e.addEventListener("click",function(){var e=this,n=this.dataset.categoryId;confirm(wgmbrManage.i18n.confirmDeleteCategory)&&(this.disabled=!0,this.textContent=wgmbrManage.i18n.deleting,fetch(wgmbrManage.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"wgmbr_delete_category",category_id:n,nonce:wgmbrManage.nonce})}).then(function(e){return e.json()}).then(function(n){var t;n.success?window.location.reload():(alert(wgmbrManage.i18n.error+" "+((null===(t=n.data)||void 0===t?void 0:t.message)||wgmbrManage.i18n.unknownError)),e.disabled=!1,e.textContent=wgmbrManage.i18n.delete)}).catch(function(n){alert(wgmbrManage.i18n.networkError+" "+n.message),e.disabled=!1,e.textContent=wgmbrManage.i18n.delete}))})})}});